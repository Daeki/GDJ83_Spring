<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.winter.app.boards.notices.NoticeDAO">
  	<sql id="searchSql">
  		<where>
			BOARDNUM>0
			<choose>
				<when test="kind=='title'">
					AND BOARDTITLE 
				</when>
				<when test="kind=='contents'">
					AND BOARDCONTENTS
				</when>
				<otherwise>
					AND BOARDWRITER
				</otherwise>
			</choose>
			LIKE '%'||#{search}||'%'
		</where>
  	
  	</sql>
  
  
  	<select id="getTotalCount" parameterType="Pager" resultType="Long">
  		SELECT COUNT(BOARDNUM) FROM NOTICE
  		<include refid="searchSql"></include> 
  	
  	</select>
  	
  	
  
  	<select id="list" parameterType="Pager" resultType="NoticeDTO">
  		SELECT * FROM
	  		(
		  		SELECT ROWNUM R, Q.* FROM
		  		(
			  		SELECT * FROM NOTICE 
			  		
			  		<include refid="searchSql"></include>
			  		
			  		ORDER BY BOARDNUM DESC
		  		) Q
		  	)
  		WHERE R BETWEEN #{startRow} AND #{lastRow}
  	</select>
  	
  	<insert id="add" parameterType="NoticeDTO">
  		INSERT INTO NOTICE 
  		(
  			BOARDNUM, BOARDWRITER, BOARDTITLE, BOARDCONTENTS, CREATEDATE, 
  			UPDATEDATE, BOARDHIT, BOARDCATEGORY 
  		)
  		VALUES
  		(
  			BOARD_SEQ.NEXTVAL, #{boardWriter}, #{boardTitle}, #{boardContents}, SYSDATE,
  			SYSDATE, 0, 'N'
  		)	
  	
  	</insert>  	
  	
  </mapper>