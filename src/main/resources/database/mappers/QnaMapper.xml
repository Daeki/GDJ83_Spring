<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.winter.app.boards.qnas.QnaDAO">
  	<sql id="searchSql">
  		<where>
			BOARDNUM>0
			<choose>
				<when test="kind=='title'">
					AND BOARDTITLE 
				</when>
				<when test="kind=='contents'">
					AND BOARDCONTENTS
				</when>
				<otherwise>
					AND BOARDWRITER
				</otherwise>
			</choose>
			LIKE '%'||#{search}||'%'
		</where>
  	
  	</sql>
  
  
  	<select id="getTotalCount" parameterType="Pager" resultType="Long">
  		SELECT COUNT(BOARDNUM) FROM QNA
  		<include refid="searchSql"></include> 
  	
  	</select>
  	
  	
  
  	<select id="list" parameterType="Pager" resultType="QnaDTO">
  		SELECT * FROM
	  		(
		  		SELECT ROWNUM R, Q.* FROM
		  		(
			  		SELECT * FROM QNA 
			  		
			  		<include refid="searchSql"></include>
			  		
			  		ORDER BY REF DESC , STEP ASC
		  		) Q
		  	)
  		WHERE R BETWEEN #{startRow} AND #{lastRow}
  	</select>
  
  	
  </mapper>